(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{"3wrN":function(e,t,i){"use strict";i("eph9")},"8yC/":function(e,t,i){"use strict";i.r(t);var a=i("gDS+"),n=i.n(a),s=i("25l2"),o=i("qRpc"),r=i("I98R"),l=i("Wu6X"),c=i("bU/s"),d=i.n(c),u=(i("5Et9"),i("h9gT"),i("gD3r"),i("A8C4"),i("I/bj")),f=i.n(u),m=i("3oRf"),h=i.n(m),p=i("fWb1"),v=i.n(p);d.a.config.setModuleUrl("ace/mode/lua_worker",f.a),d.a.config.setModuleUrl("ace/mode/lua_worker",f.a),d.a.config.setModuleUrl("ace/mode/css_worker",h.a),d.a.config.setModuleUrl("ace/keyboard/vim",v.a);var g={name:"formCode",components:{IconSelect:l.a,Event:s.a,IndexForm:o.a,EventTask:r.default},props:{isAdd:Boolean},data:function(){return{activeName:"first",evnetShow:!0,taskShow:!1,codeIcon:"",codeName:"",linkArray:[],form:{id:"",icon:"",chunk:"",version:0},serverData:[],dialogVisible:!1,linkData:[],dialogValue:"",dataTask:{},codeShow:!0}},updated:function(){this.editor=d.a.edit(this.$refs.generateId,{keyboardHandler:"ace/keyboard/vim",enableSnippets:!0,enableLiveAutocompletion:!0,enableBasicAutocompletion:!0,mode:"ace/mode/lua",theme:"ace/theme/dracula",fontSize:12,tabSize:2,value:this.dialogValue,selectionStyle:"text",showLineNumbers:!0,showGutter:!0,showPrintMargin:!0,printMarginColumn:170})},methods:{handleClick:function(e,t){"1"===e.index?(this.taskShow=!0,this.evnetShow=!1):(this.taskShow=!1,this.evnetShow=!0)},dateTime:function(e){return i("wd/R")(e).format("YYYY-MM-DD HH:mm:ss")},refreshCode:function(){this.$emit("handleEdit",this.dataTask)},editCode:function(){this.codeShow=!this.codeShow},deleteLink:function(e){n()(this.linkArray);var t=this.linkArray.indexOf(e);this.linkArray.splice(t,1)},pushLink:function(e){this.linkArray.push(e)},selected:function(e){this.form.icon=e,this.codeIcon=e},nullChange:function(e){return""!==e&&" "!==e?e:"无"},filseSuccess:function(e,t){var i=this;if(e.raw){var a=new FileReader;a.onload=function(e){i.editor.setValue(e.target.result)},a.readAsText(e.raw)}},handleRemove:function(e,t){this.editor.setValue("")},handlePreview:function(e){},handleExceed:function(e,t){this.$message.warning("当前限制选择 3 个文件，本次选择了 "+e.length+" 个文件，共选择了 "+(e.length+t.length)+" 个文件")},beforeRemove:function(e,t){return this.$confirm("确定移除 $ { file.name } ？")},handleClose:function(){this.dialogVisible=!1,this.form={}},onSubmit:function(){var e=this,t=i("J66h").Base64,a=t.encode(this.editor.getValue(this.dialogValue)),n=t.encode(this.form.icon),s={id:this.form.id,icon:n,chunk:a,version:this.form.version};this.serverData.dialect?this.$request.fetchUpdateDialect(s).then((function(t){e.refreshCode(),e.$message({message:"编辑成功",type:"success"})})).catch((function(t){e.$message.error(t.data)})):this.$request.fetchUpdataCode(s).then((function(t){e.refreshCode(),e.$message({message:"编辑成功",type:"success"})})).catch((function(t){e.$message.error(t.data)}))}},watch:{dialogValue:function(e){void 0!==this.editor&&(this.dialogValue=this.editor.setValue(e))}}},k=(i("3wrN"),i("Mttt"),i("KHd+")),_=Object(k.a)(g,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-drawer",{staticClass:"systemSet",attrs:{visible:e.dialogVisible,"show-close":!1,direction:"rtl","before-close":e.handleClose,size:"90%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[i("div",{attrs:{slot:"title"},slot:"title"}),e._v(" "),i("el-form",{ref:"form",staticStyle:{padding:"5px 10px 0 10px"},attrs:{model:e.form,"label-width":"70px","label-position":"top"}},[i("el-row",[i("el-col",{attrs:{span:12}},[i("div",{staticStyle:{display:"inline-block"}},[i("el-popover",{attrs:{placement:"bottom-start",width:"460",trigger:"click"},on:{show:function(t){return e.$refs.iconSelect.reset()}}},[i("IconSelect",{ref:"iconSelect",on:{selected:e.selected}}),e._v(" "),i("el-input",{attrs:{slot:"reference",placeholder:"点击选择图标",readonly:""},slot:"reference",model:{value:e.form.icon,callback:function(t){e.$set(e.form,"icon",t)},expression:"form.icon"}},[e.form.icon?i("svg-icon",{staticClass:"el-input__icon",staticStyle:{height:"32px",width:"16px"},attrs:{slot:"prefix","icon-class":e.form.icon},slot:"prefix"}):i("i",{staticClass:"el-icon-search el-input__icon",attrs:{slot:"prefix"},slot:"prefix"})],1)],1)],1),e._v(" "),i("el-button",{attrs:{type:"text"}},[e._v(e._s(e.serverData.name))]),e._v(" "),i("el-button",{attrs:{type:"text"}},[e._v(e._s(!0===e.serverData.dialect?"私有":"公有"))]),e._v(" "),i("el-button",{attrs:{type:"text"}},[e._v(e._s(e.dateTime(e.serverData.task_at)))]),e._v(" "),i("el-button",{attrs:{type:"text"}},[e._v(e._s(e.dateTime(e.serverData.uptime)))])],1),e._v(" "),i("el-col",{staticStyle:{"text-align":"right"},attrs:{span:12}},[i("i",{staticClass:"fa fa-code",staticStyle:{color:"#3d95ff"},attrs:{title:"显示/隐藏代码"},on:{click:e.editCode}}),e._v(" "),i("i",{staticClass:"fa fa-refresh",staticStyle:{"margin-left":"10px",color:"#63a35c",cursor:"pointer"},attrs:{title:"刷新"},on:{click:e.refreshCode}}),e._v(" "),i("i",{staticClass:"fa fa-cloud-upload",staticStyle:{"margin-left":"10px",color:"#3d95ff",cursor:"pointer"},attrs:{title:"提交"},on:{click:function(t){return e.onSubmit("form")}}}),e._v(" "),i("i",{staticClass:"fa fa-close",staticStyle:{margin:"0 5px 0 10px",color:"#9e9e9e",cursor:"pointer"},attrs:{title:"关闭"},on:{click:function(t){e.dialogVisible=!1}}})])],1),e._v(" "),i("el-row",[i("el-col",{attrs:{span:19}},[i("el-row",[e.codeShow?i("el-col",{attrs:{span:24}},[i("div",{ref:"generateId",staticClass:"code-editor"})]):e._e()],1),e._v(" "),i("el-row",{staticStyle:{"margin-top":"10px"}},[i("el-col",{attrs:{span:24}},[i("EventTask",{attrs:{dataTask:e.serverData}})],1)],1)],1),e._v(" "),i("el-col",{staticStyle:{"padding-left":"8px"},attrs:{span:5}},[i("el-card",[i("el-row",[i("el-col",{staticStyle:{"margin-bottom":"10px"}},[i("h3",{staticStyle:{color:"#f2f6fca8"}},[e._v("任务信息")])]),e._v(" "),i("el-col",{staticStyle:{"margin-bottom":"8px"}},[i("span",{attrs:{type:"info",size:"mini"}},[e._v("任务名称："+e._s(e.serverData.name))])]),e._v(" "),i("el-col",{staticStyle:{"margin-bottom":"20px"}},[i("span",{attrs:{type:"info",size:"mini"}},[e._v("描述信息："+e._s(e.nullChange(e.serverData.desc)))])])],1)],1)],1)],1)],1)],1)}),[],!1,null,"0dda8a8f",null).exports,b=i("/zyf");d.a.config.setModuleUrl("ace/mode/lua_worker",f.a),d.a.config.setModuleUrl("ace/mode/lua_worker",f.a),d.a.config.setModuleUrl("ace/mode/css_worker",h.a),d.a.config.setModuleUrl("ace/keyboard/vim",v.a);var y={name:"addForm",components:{IconSelect:l.a},props:{isAdd:Boolean},data:function(){return{codeIcon:"",codeName:"",linkArray:[],form:{name:"",icon:"通用",desc:"",links:[],chunk:"",id:""},dialogVisible:!1,linkData:[],dialogValue:"",rules:{},editor:""}},updated:function(){var e=this;e.editor=d.a.edit(this.$refs.generateId,{keyboardHandler:"ace/keyboard/vim",enableSnippets:!0,enableLiveAutocompletion:!0,enableBasicAutocompletion:!0,mode:"ace/mode/lua",theme:"ace/theme/dracula",fontSize:12,tabSize:4,value:this.dialogValue,selectionStyle:"text'",showLineNumbers:!0,showGutter:!0,showPrintMargin:!0,printMarginColumn:170}),e.editor.getSession().on("change",(function(t){e.form.chunk=e.editor.getValue(this.dialogValue)}))},created:function(){this.getLinks()},methods:{linkCompare:function(e){return this.linkArray.some((function(t){if(t.id===e.id)return!0}))},deleteLink:function(e){n()(this.linkArray);var t=this.linkArray.indexOf(e);this.linkArray.splice(t,1)},pushLink:function(e){this.linkArray.push(e)},selected:function(e){this.form.icon=e,this.codeIcon=e},getLinks:function(){var e=this;this.$request.fetchGetLinks("").then((function(t){e.linkData=t.data})).catch((function(t){e.$message.error(t.data)}))},beforeRemove:function(e,t){return this.$confirm("确定移除 $ { file.name } ？")},filseSuccess:function(e,t){var i=this;if(e.raw){var a=new FileReader;a.onload=function(e){i.form.chunk=e.target.result},a.readAsText(e.raw)}},handleRemove:function(e,t){this.form.chunk=""},handleExceed:function(e,t){this.$message.warning("当前限制选择 3 个文件，本次选择了 "+e.length+" 个文件，共选择了 "+(e.length+t.length)+" 个文件")},handleClose:function(){this.dialogVisible=!1,this.form={}},onSubmit:function(e){var t=this;this.$refs[e].validate((function(e){if(e){var a=i("J66h").Base64,n=a.encode(t.form.icon),s=a.encode(t.form.chunk),o={name:t.form.name,icon:n,desc:t.form.desc,links:t.form.links,chunk:s,id:t.form.id};t.$request.fetchAddCode(o).then((function(e){t.$parent.getCode(),t.dialogVisible=!1,t.editor.setValue(""),t.form={name:"",icon:"kafka",desc:"",links:[],chunk:"",id:""},t.$refs.file.clearFiles(),t.$message({message:"新增成功",type:"success"})})).catch((function(e){t.$message.error(e.data)}))}}))}}},C=(i("vO05"),i("jJO4"),Object(k.a)(y,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-dialog",{staticClass:"code-form",attrs:{"show-close":!1,"close-on-press-escape":!1,"close-on-click-modal":!1,top:"50px","el-dialog":"",visible:e.dialogVisible,"append-to-body":"",width:"70%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[i("el-form",{ref:"form",staticClass:"formAdd",attrs:{model:e.form,rules:e.rules,"label-width":"40px"}},[i("el-row",[i("el-col",{staticStyle:{margin:"20px 20px"},attrs:{span:5}},[i("el-form-item",{attrs:{label:" ",prop:"chunk"}},[i("el-upload",{ref:"file",staticClass:"upload-demo",attrs:{action:"/","on-remove":e.handleRemove,"before-remove":e.beforeRemove,"on-change":e.filseSuccess,multiple:"",limit:3,"on-exceed":e.handleExceed,"auto-upload":!1}},[i("el-button",{attrs:{size:"mini",type:"primary"}},[e._v("点击上传 chunk")])],1)],1),e._v(" "),i("el-form-item",{attrs:{label:"名称",prop:"name"}},[i("el-input",{attrs:{type:"text",size:"mini"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"图标",prop:"icon"}},[i("el-popover",{attrs:{placement:"bottom-start",width:"460",trigger:"click"},on:{show:function(t){return e.$refs.iconSelect.reset()}}},[i("IconSelect",{ref:"iconSelect",on:{selected:e.selected}}),e._v(" "),i("el-input",{attrs:{slot:"reference",placeholder:"点击选择图标",size:"mini",readonly:""},slot:"reference",model:{value:e.form.icon,callback:function(t){e.$set(e.form,"icon",t)},expression:"form.icon"}},[e._v("\n              "+e._s(e.form.icon)+"\n              "),e.form.icon?i("svg-icon",{staticClass:"el-input__icon",staticStyle:{height:"42px",width:"16px"},attrs:{slot:"prefix","icon-class":e.form.icon},slot:"prefix"}):i("i",{staticClass:"el-icon-search el-input__icon",attrs:{slot:"prefix"},slot:"prefix"})],1)],1)],1),e._v(" "),i("el-form-item",{attrs:{label:"描述",prop:"desc"}},[i("el-input",{attrs:{type:"textarea",placeholder:"请输入描述"},model:{value:e.form.desc,callback:function(t){e.$set(e.form,"desc",t)},expression:"form.desc"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"外链",prop:"links"}},[i("el-select",{staticStyle:{width:"100%"},attrs:{multiple:"",size:"mini"},model:{value:e.form.links,callback:function(t){e.$set(e.form,"links",t)},expression:"form.links"}},e._l(e.linkData,(function(e){return i("el-option",{key:e.id,attrs:{value:e.id,label:e.name}})})),1)],1),e._v(" "),i("span",{staticStyle:{width:"100%","text-align":"right",display:"inline-block"}},[i("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.onSubmit("form")}}},[e._v("提交")])],1)],1),e._v(" "),i("div",{staticStyle:{height:"20px","text-align":"right",padding:"5px"}},[i("i",{staticClass:"fa fa-close",staticStyle:{margin:"0 5px 0 10px",color:"#9e9e9e",cursor:"pointer"},on:{click:function(t){e.dialogVisible=!1}}})]),e._v(" "),i("div",{ref:"generateId",staticClass:"code-editor"})],1)],1),e._v(" "),i("div",{attrs:{slot:"title"},slot:"title"})],1)}),[],!1,null,"3a88c648",null).exports),x=(i("vQJo"),{name:"node",components:{Form:_,Page:b.a,AddForm:C},data:function(){return{current:1,size:10,pageTotal:0,pageSizeArray:["10","20","30","40"],codeData:[],isAdd:!0,delLoading:!1,avatar:"../../../static/images/favicon.ico",selectInput:""}},created:function(){this.getCode()},methods:{iconImg:function(e){return i("J66h").Base64.decode(e)},edit:function(e){var t=this;this.$request.fetchUpdataCodeEdit(e.id).then((function(a){var n=i("J66h").Base64,s=t.$refs.forms;s.serverData=e,s.dialogValue=n.decode(a.data.chunk),s.form={name:a.data.name,icon:n.decode(a.data.icon),desc:a.data.desc,links:a.data.links,chunk:n.decode(a.data.chunk),id:a.data.id,version:a.data.version},s.codeIcon=n.decode(a.data.icon),s.codeName=a.data.name,s.linkArray=a.data.links,s.dialogVisible=!0})).catch((function(e){t.$message.error(e.data)}))},format:function(e){return 100===e?"100%":e+"%"},percentageChange:function(e,t){return 0===e?0:parseInt(e/t*1e4)/100},customColorMethod:function(e,t){var i=this.percentageChange(e,t);return i<30?"#67c23a":i<70?"#e6a23c":"#f56c6c"},handleSizeChange:function(e){this.size=e,this.getCode()},handleCurrentChange:function(e){this.current=e,this.getCode()},addCode:function(){var e=this;this.$nextTick((function(){e.$refs.formAdd.dialogVisible=!0}))},subDelete:function(e){var t=this,i=this;i.delLoading=!0,this.$request.fetchDeleteCode(e).then((function(e){i.$message({message:"删除成功!!!",type:"success"}),i.delLoading=!1,i.getCode()})).catch((function(e){t.$message.error(e.data)}))},getCode:function(){var e=this,t={current:this.current,size:this.size,name:this.selectInput};this.$request.fetchGetCode(t).then((function(t){e.codeData=t.data.records,e.pageTotal=t.data.total})).catch((function(t){e.$message.error(t.data)}))},handleEdit:function(e,t){},handleDelete:function(e,t){this.$message({showClose:!0,message:e,row:t,type:"success"})},formatter:function(e,t){return e.address},filterTag:function(e,t){return t.tag===e},filterHandler:function(e,t,i){return t[i.property]===e}}}),w=(i("vymF"),Object(k.a)(x,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticStyle:{width:"100%"}},[i("el-card",[i("el-row",[i("el-col",{attrs:{span:12}},[i("el-input",{staticClass:"input-with-select",staticStyle:{width:"20%"},attrs:{placeholder:"请输入名称",size:"mini"},model:{value:e.selectInput,callback:function(t){e.selectInput=t},expression:"selectInput"}}),e._v(" "),i("el-button",{staticStyle:{color:"#909399",background:"#f4f4f5","border-color":"#d3d4d6"},attrs:{icon:"el-icon-search",size:"mini"},on:{click:e.getCode}})],1),e._v(" "),i("el-col",{staticStyle:{"text-align":"right"},attrs:{span:12}},[i("el-button",{staticStyle:{"margin-left":"0"},attrs:{"el-button":"",type:"success",plain:"",size:"mini"},on:{click:e.addCode}},[e._v("添加")])],1)],1),e._v(" "),null!==e.codeData?i("div",{staticClass:"ivu-list-split"},e._l(e.codeData,(function(t){return i("ul",{key:t.id,staticClass:"ivu-list-items"},[i("li",{staticClass:"ivu-list-item"},[i("div",{staticClass:"ivu-list-item-meta"},[i("div",{staticClass:"ivu-list-item-meta-avatar"},[i("span",{staticClass:"ivu-avatar ivu-avatar-square ivu-avatar-image ivu-avatar-large"},[i("svg-icon",{staticClass:"el-input__icon",staticStyle:{height:"42px",width:"32px"},attrs:{slot:"prefix","icon-class":e.iconImg(t.icon)},slot:"prefix"})],1)]),e._v(" "),i("div",{staticClass:"ivu-list-item-meta-content"},[i("div",{staticClass:"ivu-list-item-meta-title"},[e._v(e._s(t.desc))]),e._v(" "),i("div",{staticClass:"ivu-list-item-meta-description"},[e._v(e._s(t.name))])])]),e._v(" "),i("div",{staticClass:"list-basic-list-content"},[i("div",{staticClass:"list-basic-list-content-item",staticStyle:{width:"240px"}},[i("span",[e._v("开始时间")]),e._v(" "),i("p",[e._v(e._s(e._f("date")(t.created_at,"yyyy-MM-dd hh:mm:ss")))])])]),e._v(" "),i("ul",{staticClass:"ivu-list-item-action"},[i("li",[i("el-button",{attrs:{type:"text"},on:{click:function(i){return e.edit(t)}}},[e._v("编辑")])],1),e._v(" "),i("li",[i("el-button",{attrs:{type:"text"},on:{click:function(i){return e.subDelete(t.id)}}},[e._v("删除")])],1)])])])})),0):e._e(),e._v(" "),i("Page",{attrs:{size:e.size,current:e.current,pageSizeArray:e.pageSizeArray,pageTotal:e.pageTotal},on:{handleSizeChange:e.handleSizeChange,handleCurrentChange:e.handleCurrentChange}})],1),e._v(" "),i("Form",{ref:"forms",attrs:{"is-add":e.isAdd}}),e._v(" "),i("AddForm",{ref:"formAdd"})],1)}),[],!1,null,"7dc9ab01",null));t.default=w.exports},Mttt:function(e,t,i){"use strict";i("aT9F")},UtBw:function(e,t,i){},VtHg:function(e,t,i){},aT9F:function(e,t,i){},eph9:function(e,t,i){},jJO4:function(e,t,i){"use strict";i("vR5W")},vO05:function(e,t,i){"use strict";i("VtHg")},vR5W:function(e,t,i){},vymF:function(e,t,i){"use strict";i("UtBw")}}]);
//# sourceMappingURL=17.46207dd61c5d734f333b.js.map