(window.webpackJsonp=window.webpackJsonp||[]).push([[45],{"6wD5":function(t,e,a){"use strict";a("JcAe")},"8rOb":function(t,e,a){"use strict";a.r(e);var s=a("jxM8"),i=a("hJFz"),n=a("/zyf"),r=a("ThUY"),o=(a("vQJo"),a("/qbm")),c=a("N0jg"),l=(a("wd/R"),{components:{Page:n.a,selectSearch:r.a,AddForm:o.default,addService:i.a,NodeDetail:c.a,Event:s.a},name:"taskDetail",data:function(){return{drawerEvent:!1,eventDetailShow:!1,tableLoading:!1,topEchartShow:!1,initData:{},currentPage:1,pageSize:13,delLoading:!1,selectArray:[{model:"",placeholder:"运行状态",name:"status",dataArray:[{key:"running",desc:"running"},{key:"doing",desc:"doing"},{key:"fail",desc:"fail"},{key:"panic",desc:"panic"},{key:"reg",desc:"reg"},{key:"update",desc:"update"}]},{model:"",placeholder:"属性",name:"dialect",dataArray:[{key:"true",desc:"私有"},{key:"false",desc:"公有"}]}],ipTtitel:{},drawer:!1,directions:"rtl",dataTask:{},eventsData:[],processShow:!1,processDetailData:{},pageSizeArray:["10","20","30","40"],searchName:"",condData:{},startTime:null,endTime:null,value:"",operator:"",field:"",filters:[],activeIndex:null}},created:function(){this.init(),this.getCond()},methods:{closeEvent:function(t){this.drawerEvent=t},attackShow:function(){this.$emit("activeClick",!0,!1)},echartShow:function(){this.topEchartShow=!this.topEchartShow,this.$emit("activechartShow")},drawerClose:function(){this.drawer=!1,this.ipTtitel={}},innetactive:function(t){this.ipTtitel=t,this.drawer=!0},getCond:function(){var t=this;this.$request.fetchTaskCond().then((function(e){t.condData=e.data}))},searchBasic:function(t){this.currentPage=1,this.filters=t,this.init()},init:function(){var t=this;this.tableLoading=!0;var e={current:this.currentPage,size:this.pageSize,filters:this.filters};this.$request.fetchGetTask(e).then((function(e){t.tableLoading=!1,t.initData=e.data}))},handleSizeChange:function(t){this.pageSize=t,this.init()},handleCurrentChange:function(t){this.currentPage=t,this.init()},reloadService:function(t){var e=this,a={id:t.minion_id,substance_id:t.substance_id,dialect:t.dialect};this.$request.fetchPatchReload(a).then((function(t){e.$message.success("重启成功！！")})).catch((function(t){e.$message.error(t.data)}))},handleEvent:function(t){var e=this;this.eventDetailShow=!0;var s={current:1,size:100,filters:[{key:"minion_id",value:t.minion_id,operator:"eq"},{key:"from_code",value:t.from,operator:"eq"}]},i=this,n=a("wd/R");this.$request.fetchGetEents(s).then((function(t){null!==t.data.records?e.eventsData=t.data.records.map((function(t){return t.occur_at=n(t.occur_at).format("YYYY-MM-DD HH:mm:ss"),t})):e.eventsData=[],i.drawerEvent=!0}))},handleEdit:function(t){var e=this,s=this.$refs.formAdd;this.$request.fetchdetailDialect(t.minion_id,t.substance_id).then((function(e){var i=a("J66h").Base64;s.serverData=e.data,s.dataTask=t,e.data.chunk?s.dialogValue=i.decode(e.data.chunk):s.dialogValue=i.decode(" "),s.form={id:e.data.id,icon:e.data.icon,chunk:e.data.chunk,version:e.data.version},s.codeName=e.data.name,s.linkArray=e.data.links,s.dialogVisible=!0})).catch((function(t){e.$message.error(t.data)}))},delCode:function(t){var e=this;this.$refs[t].doClose();var a=this;a.delLoading=!0,this.$request.fetchDeleteCodeEdit(t).then((function(){a.$message({message:"删除成功!!!",type:"success"}),a.delLoading=!1,a.init()})).catch((function(t){a.delLoading=!1,e.$message.error(t.data)}))},addService:function(){var t=this.$refs.addService;t.form.minion_id=this.$route.params.id,t.serverVisible=!0},searchAdd:function(t,e){this.currentPage=1;var a,s=this.$refs.select;this.activeAdd=[{key:t.key,value:e,operator:"eq"}],a=[{key:t,value:e,operator:{desc:"等于",key:"eq"}}],s.filtersshow=a,this.filters=this.activeAdd,this.init()},resync:function(){var t=this;this.$request.fetchBatch({cmd:"resync",filters:[]}).then((function(e){t.$message({message:"同步成功!!!",type:"success"})})).catch((function(e){t.$message.error(e.data)}))},getNode:function(){this.init()},refresh:function(){var t=this;this.$request.fetchNodeDetail(this.$route.params.id).then((function(e){t.nodeListData=e.data})).catch((function(){t.nodeListData=[]}))},detailData:function(t){this.$message({message:"开发中！！！",type:"warning"})},processCancel:function(){this.processDetailData={},this.processShow=!1}}}),d=(a("6wD5"),a("KHd+")),u=Object(d.a)(l,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-row",[a("el-col",{attrs:{span:14}},[a("select-search",{ref:"select",attrs:{condData:t.condData,selectArray:t.selectArray},on:{searchBasic:t.searchBasic}})],1),t._v(" "),a("el-col",{staticStyle:{"text-align":"right"},attrs:{span:10}},[a("el-button",{staticStyle:{margin:"10px 0"},attrs:{type:"success",plain:"",size:"mini"},on:{click:t.echartShow}},[t._v("\n        "+t._s(!0===t.topEchartShow?"隐藏图表":"显示图表")+"\n      ")]),t._v(" "),a("span",{staticStyle:{margin:"10px 0"}},[a("el-button",{attrs:{type:"primary",plain:"",size:"mini"},on:{click:t.resync}},[t._v("一键同步")])],1),t._v(" "),a("span",{staticStyle:{margin:"10px 0"}},[a("el-button",{attrs:{plain:"",type:"primary",size:"mini"},on:{click:t.addService}},[t._v("发布")])],1),t._v(" "),a("span",{staticStyle:{margin:"10px 0"}},[a("el-button",{attrs:{type:"primary",plain:"",size:"mini"},on:{click:t.refresh}},[t._v("刷新")])],1),t._v(" "),a("el-button-group",[a("el-button",{attrs:{type:"primary",size:"mini"}},[t._v("任务详情")]),t._v(" "),a("el-button",{attrs:{type:"info",size:"mini"},on:{click:t.attackShow}},[t._v("任务汇总")])],1)],1)],1),t._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.tableLoading,expression:"tableLoading"}],staticStyle:{width:"100%","margin-top":"5px"},attrs:{data:t.initData.records,border:"","header-cell-style":{color:"#909399",textAlign:"center",background:"#f5f7fa"},"cell-style":{padding:"12px 0"}}},[a("el-table-column",{attrs:{prop:"inet",label:"终端IP",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(a){return t.innetactive(e.row)}}},[t._v(t._s(e.row.inet))]),t._v(" "),a("i",{staticClass:"el-icon-circle-plus-outline",staticStyle:{"margin-left":"5px",color:"#3d95ff",cursor:"pointer"},on:{click:function(a){t.searchAdd({key:"inet",desc:"节点 IPv4"},e.row.inet)}}})]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"name",label:"名称"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(a){return t.handleEdit(e.row)}}},[e.row.report_hash!==e.row.hash?a("span",{staticStyle:{color:"red"}},[t._v("\n               "+t._s(e.row.name)),a("i",{staticClass:"el-icon-circle-plus-outline",staticStyle:{"margin-left":"5px",color:"#3d95ff",cursor:"pointer"},on:{click:function(a){return t.searchAdd({key:"name",desc:"配置名称"},e.row.name)}}}),t._v(" "),a("el-tooltip",{attrs:{effect:"dark",content:"下发的配置与数据库中的配置校验不一致",placement:"right"}},[a("i",{staticClass:"fa fa-exclamation-circle"})])],1):a("span",[t._v("\n              "+t._s(e.row.name)),a("i",{staticClass:"el-icon-circle-plus-outline",staticStyle:{"margin-left":"5px",color:"#3d95ff",cursor:"pointer"},on:{click:function(a){return t.searchAdd({key:"name",desc:"配置名称"},e.row.name)}}})])])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"from",label:"来源"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.from?a("span",[t._v(t._s(e.row.from))]):a("span",[t._v("未知")])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"dialect",label:"属性"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n        "+t._s(!0===e.row.dialect?"私有":"公有")+"\n      ")]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"status",label:"状态"},scopedSlots:t._u([{key:"default",fn:function(e){return["console"===e.row.from?a("span",[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"scope.row.error",placement:"bottom"}},[e.row.status?a("span",[a("el-tag",{attrs:{effect:"plain",size:"small",type:"running"===e.row.status?"success":"error"===e.row.status?"warning":"danger"}},[t._v(t._s(e.row.status)+"\n              "),a("span",{staticClass:"statu",class:"running"===e.row.status?"green-circle":"error"===e.row.status?"red-circle":"yellow-circle"})]),t._v(" "),a("i",{staticClass:"el-icon-circle-plus-outline",staticStyle:{"margin-left":"5px",color:"#3d95ff",cursor:"pointer"},on:{click:function(a){return t.searchAdd({key:"status",desc:"运行状态"},e.row.status)}}})],1):a("span",[t._v("未知\n              ")])])],1):a("span",[e.row.status?a("span",[a("el-tag",{attrs:{effect:"plain",size:"small",type:"running"===e.row.status?"success":"error"===e.row.status?"warning":"danger"}},[t._v(t._s(e.row.status)+"\n            "),a("span",{staticClass:"statu",class:"running"===e.row.status?"green-circle":"error"===e.row.status?"red-circle":"yellow-circle"})]),t._v(" "),a("i",{staticClass:"el-icon-circle-plus-outline",staticStyle:{"margin-left":"5px",color:"#3d95ff",cursor:"pointer"},on:{click:function(a){return t.searchAdd({key:"status",desc:"运行状态"},e.row.status)}}})],1):a("span",[t._v("未知\n            ")])])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"link",label:"外链"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.link?a("span",[t._v(t._s(e.row.link))]):a("span",[t._v("无")])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"created_at",label:"创建时间"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n        "+t._s(t._f("date")(e.row.created_at,"yyyy-MM-dd hh:mm:ss"))+"\n      ")]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"操作",align:"right",width:"180"},scopedSlots:t._u([{key:"default",fn:function(e){return["console"!==e.row.from?a("span",[a("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(a){return t.handleEvent(e.row)}}},[t._v("事件")]),t._v(" "),a("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(a){return t.reloadService(e.row)}}},[t._v("重启")])],1):t._e(),t._v(" "),e.row.dialect&&"startup"!==e.row.name?a("el-popover",{ref:e.row.substance_id,attrs:{placement:"top"}},[a("p",[t._v("确定删除?")]),t._v(" "),a("div",{staticStyle:{"text-align":"right",margin:"0"}},[a("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(a){t.$refs[e.row.substance_id].doClose()}}},[t._v("取消")]),t._v(" "),a("el-button",{attrs:{loading:t.delLoading,type:"primary",size:"mini"},on:{click:function(a){return t.delCode(e.row.substance_id)}}},[t._v("确定\n            ")])],1),t._v(" "),a("el-button",{staticStyle:{"margin-left":"3%"},attrs:{slot:"reference",type:"text",size:"mini"},slot:"reference"},[t._v("删除")])],1):a("span",{staticStyle:{color:"#c0c4cc","margin-left":"3%"}},[t._v("删除")])]}}])})],1),t._v(" "),a("Page",{attrs:{size:t.pageSize,current:t.currentPage,pageTotal:t.initData.total,pageSizeArray:t.pageSizeArray},on:{handleSizeChange:t.handleSizeChange,handleCurrentChange:t.handleCurrentChange}}),t._v(" "),a("el-drawer",{staticClass:"eventDrawer",attrs:{visible:t.processShow,direction:"rtl",size:"25%"},on:{"update:visible":function(e){t.processShow=e},close:t.processCancel}},[a("div",{staticStyle:{padding:"0  20px"}},[a("span",{staticStyle:{"font-size":"13px",color:"#86909c","font-weight":"bold"}},[a("el-row",{staticStyle:{"margin-bottom":"14px"}},[a("el-col",{attrs:{span:12}},[a("span",{staticClass:"controlCard",staticStyle:{"font-size":"12px"}},[t._v("进程详情")])])],1),t._v(" "),a("el-row",{staticStyle:{"margin-bottom":"14px"}},[a("el-col",{attrs:{span:24}},[t._v("进程名称\n              "),a("span",{staticClass:"subtitle"},[t._v(t._s(t.processDetailData.name))])])],1),t._v(" "),a("el-row",{staticStyle:{"margin-bottom":"14px"}},[a("el-col",{attrs:{span:24}},[t._v("内存使用"),a("span",{staticClass:"subtitle"},[t._v(t._s(t.processDetailData.mem_size||"-"))])])],1),t._v(" "),a("el-row",{staticStyle:{"margin-bottom":"14px"}},[a("el-col",{attrs:{span:24}},[t._v("进程PID"),a("span",{staticClass:"subtitle"},[t._v(t._s(t.processDetailData.pid))])])],1),t._v(" "),a("el-row",{staticStyle:{"margin-bottom":"14px"}},[a("el-col",{attrs:{span:24}},[t._v("进程PPID"),a("span",{staticClass:"subtitle"},[t._v(t._s(t.processDetailData.ppid))])])],1),t._v(" "),a("el-row",{staticStyle:{"margin-bottom":"14px"}},[a("el-col",{attrs:{span:24}},[t._v("用户信息"),a("span",{staticClass:"subtitle"},[t._v(t._s(t.processDetailData.username))])])],1),t._v(" "),a("el-row",{staticStyle:{"margin-bottom":"14px"}},[a("el-col",{attrs:{span:24}},[t._v("处理字节"),a("span",{staticClass:"subtitle"},[t._v(t._s(t.processDetailData.rss_bytes||"-"))])])],1),t._v(" "),a("el-row",{staticStyle:{"margin-bottom":"14px"}},[a("el-col",{attrs:{span:24}},[t._v("启动时间"),a("span",{staticClass:"subtitle"},[t._v(t._s(t._f("date")(t.processDetailData.created_at,"yyyy-MM-dd hh:mm:ss")))])])],1),t._v(" "),a("el-row",{staticStyle:{"margin-bottom":"14px"}},[a("el-col",{attrs:{span:24}},[t._v("启动参数"),a("span",{staticClass:"subtitle"},[t.processDetailData.args?a("span",[t.processDetailData.args.length>0?a("span",t._l(t.processDetailData.args,(function(e,s){return a("span",{key:s},[a("el-tag",{staticStyle:{"margin-right":"10px"},attrs:{type:"info",size:"mini"}},[t._v(t._s(e))])],1)})),0):t._e()]):a("span",[t._v("-")])])])],1),t._v(" "),a("el-row",{staticStyle:{"margin-bottom":"14px"}},[a("el-col",{attrs:{span:24}},[t._v("启动命令"),a("span",{staticClass:"subtitle"},[t._v(t._s(t.processDetailData.cmdline||"-"))])])],1),t._v(" "),a("el-row",{staticStyle:{"margin-bottom":"14px"}},[a("el-col",{attrs:{span:24}},[t._v("进程路径"),a("span",{staticClass:"subtitle"},[t._v(t._s(t.processDetailData.executable||"-"))])])],1),t._v(" "),a("el-row",{staticStyle:{"margin-bottom":"14px"}},[a("el-col",{attrs:{span:24}},[t._v("checksum"),a("span",{staticClass:"subtitle"},[t._v(t._s(t.processDetailData.checksum||"-"))])])],1)],1)])]),t._v(" "),a("AddForm",{ref:"formAdd",on:{handleEdit:t.handleEdit}}),t._v(" "),a("addService",{ref:"addService",on:{getNode:t.getNode}}),t._v(" "),t.eventDetailShow?a("Event",{ref:"eventDetail",attrs:{drawerEvent:t.drawerEvent,eventsData:t.eventsData},on:{closeEvent:t.closeEvent}}):t._e(),t._v(" "),a("el-drawer",{staticClass:"inetDrawer",attrs:{title:t.ipTtitel.inet,visible:t.drawer,direction:t.directions,"before-close":t.drawerClose,size:"90%"},on:{"update:visible":function(e){t.drawer=e}}},[a("node-detail",{ref:"ipDetail",attrs:{minionId:t.ipTtitel.minion_id,dataTask:t.ipTtitel}})],1)],1)}),[],!1,null,"024daed6",null).exports,p=a("g2+6"),h={components:{taskDetail:u,taskSum:a("CCOd").a,taskCount:p.a},name:"index",data:function(){return{taskDetailShow:!0,taskSumShow:!1,recentData:[],chartShow:!1}},methods:{activeClick:function(t,e){this.chartShow=!1,this.taskSumShow=t,this.taskDetailShow=e},activechartShow:function(){this.chartShow=!this.chartShow},getRecent:function(t){var e=this;this.$request.fetchRevent(t).then((function(t){e.recentData=t.data,e.recentShow=!0}))}}},v=Object(d.a)(h,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-card",[t.chartShow?a("el-row",{attrs:{gutter:10}},[a("el-col",{staticStyle:{"margin-bottom":"10px"},attrs:{span:24}},[a("taskCount")],1)],1):t._e(),t._v(" "),t.taskDetailShow?a("taskDetail",{on:{activeClick:t.activeClick,activechartShow:t.activechartShow}}):t._e(),t._v(" "),t.taskSumShow?a("taskSum",{on:{activeClick:t.activeClick,activechartShow:t.activechartShow}}):t._e()],1)}),[],!1,null,"f6c012e4",null);e.default=v.exports},JcAe:function(t,e,a){}}]);
//# sourceMappingURL=45.685460e7c5ff87f58e5e.js.map