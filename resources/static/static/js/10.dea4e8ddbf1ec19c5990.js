(window.webpackJsonp=window.webpackJsonp||[]).push([[10,45],{"2QRM":function(t,e,a){},"5Ekh":function(t,e,a){"use strict";a("2QRM")},"6wD5":function(t,e,a){"use strict";a("JcAe")},"8rOb":function(t,e,a){"use strict";a.r(e);var i=a("jxM8"),s=a("hJFz"),n=a("/zyf"),o=a("ThUY"),r=(a("vQJo"),a("/qbm")),c=a("N0jg"),l=(a("wd/R"),{components:{Page:n.a,selectSearch:o.a,AddForm:r.default,addService:s.a,NodeDetail:c.a,Event:i.a},name:"taskDetail",data:function(){return{drawerEvent:!1,eventDetailShow:!1,tableLoading:!1,topEchartShow:!1,initData:{},currentPage:1,pageSize:13,delLoading:!1,selectArray:[{model:"",placeholder:"运行状态",name:"status",dataArray:[{key:"running",desc:"running"},{key:"doing",desc:"doing"},{key:"fail",desc:"fail"},{key:"panic",desc:"panic"},{key:"reg",desc:"reg"},{key:"update",desc:"update"}]},{model:"",placeholder:"属性",name:"dialect",dataArray:[{key:"true",desc:"私有"},{key:"false",desc:"公有"}]}],ipTtitel:{},drawer:!1,directions:"rtl",dataTask:{},eventsData:[],processShow:!1,processDetailData:{},pageSizeArray:["10","20","30","40"],searchName:"",condData:{},startTime:null,endTime:null,value:"",operator:"",field:"",filters:[],activeIndex:null}},created:function(){this.init(),this.getCond()},methods:{closeEvent:function(t){this.drawerEvent=t},attackShow:function(){this.$emit("activeClick",!0,!1)},echartShow:function(){this.topEchartShow=!this.topEchartShow,this.$emit("activechartShow")},drawerClose:function(){this.drawer=!1,this.ipTtitel={}},innetactive:function(t){this.ipTtitel=t,this.drawer=!0},getCond:function(){var t=this;this.$request.fetchTaskCond().then((function(e){t.condData=e.data}))},searchBasic:function(t){this.currentPage=1,this.filters=t,this.init()},init:function(){var t=this;this.tableLoading=!0;var e={current:this.currentPage,size:this.pageSize,filters:this.filters};this.$request.fetchGetTask(e).then((function(e){t.tableLoading=!1,t.initData=e.data}))},handleSizeChange:function(t){this.pageSize=t,this.init()},handleCurrentChange:function(t){this.currentPage=t,this.init()},reloadService:function(t){var e=this,a={id:t.minion_id,substance_id:t.substance_id,dialect:t.dialect};this.$request.fetchPatchReload(a).then((function(t){e.$message.success("重启成功！！")})).catch((function(t){e.$message.error(t.data)}))},handleEvent:function(t){var e=this;this.eventDetailShow=!0;var i={current:1,size:100,filters:[{key:"minion_id",value:t.minion_id,operator:"eq"},{key:"from_code",value:t.from,operator:"eq"}]},s=this,n=a("wd/R");this.$request.fetchGetEents(i).then((function(t){null!==t.data.records?e.eventsData=t.data.records.map((function(t){return t.occur_at=n(t.occur_at).format("YYYY-MM-DD HH:mm:ss"),t})):e.eventsData=[],s.drawerEvent=!0}))},handleEdit:function(t){var e=this,i=this.$refs.formAdd;this.$request.fetchdetailDialect(t.minion_id,t.substance_id).then((function(e){var s=a("J66h").Base64;i.serverData=e.data,i.dataTask=t,e.data.chunk?i.dialogValue=s.decode(e.data.chunk):i.dialogValue=s.decode(" "),i.form={id:e.data.id,icon:e.data.icon,chunk:e.data.chunk,version:e.data.version},i.codeName=e.data.name,i.linkArray=e.data.links,i.dialogVisible=!0})).catch((function(t){e.$message.error(t.data)}))},delCode:function(t){var e=this;this.$refs[t].doClose();var a=this;a.delLoading=!0,this.$request.fetchDeleteCodeEdit(t).then((function(){a.$message({message:"删除成功!!!",type:"success"}),a.delLoading=!1,a.init()})).catch((function(t){a.delLoading=!1,e.$message.error(t.data)}))},addService:function(){var t=this.$refs.addService;t.form.minion_id=this.$route.params.id,t.serverVisible=!0},searchAdd:function(t,e){this.currentPage=1;var a,i=this.$refs.select;this.activeAdd=[{key:t.key,value:e,operator:"eq"}],a=[{key:t,value:e,operator:{desc:"等于",key:"eq"}}],i.filtersshow=a,this.filters=this.activeAdd,this.init()},resync:function(){var t=this;this.$request.fetchBatch({cmd:"resync",filters:[]}).then((function(e){t.$message({message:"同步成功!!!",type:"success"})})).catch((function(e){t.$message.error(e.data)}))},getNode:function(){this.init()},refresh:function(){var t=this;this.$request.fetchNodeDetail(this.$route.params.id).then((function(e){t.nodeListData=e.data})).catch((function(){t.nodeListData=[]}))},detailData:function(t){this.$message({message:"开发中！！！",type:"warning"})},processCancel:function(){this.processDetailData={},this.processShow=!1}}}),d=(a("6wD5"),a("KHd+")),u=Object(d.a)(l,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-row",[a("el-col",{attrs:{span:14}},[a("select-search",{ref:"select",attrs:{condData:t.condData,selectArray:t.selectArray},on:{searchBasic:t.searchBasic}})],1),t._v(" "),a("el-col",{staticStyle:{"text-align":"right"},attrs:{span:10}},[a("el-button",{staticStyle:{margin:"10px 0"},attrs:{type:"success",plain:"",size:"mini"},on:{click:t.echartShow}},[t._v("\n        "+t._s(!0===t.topEchartShow?"隐藏图表":"显示图表")+"\n      ")]),t._v(" "),a("span",{staticStyle:{margin:"10px 0"}},[a("el-button",{attrs:{type:"primary",plain:"",size:"mini"},on:{click:t.resync}},[t._v("一键同步")])],1),t._v(" "),a("span",{staticStyle:{margin:"10px 0"}},[a("el-button",{attrs:{plain:"",type:"primary",size:"mini"},on:{click:t.addService}},[t._v("发布")])],1),t._v(" "),a("span",{staticStyle:{margin:"10px 0"}},[a("el-button",{attrs:{type:"primary",plain:"",size:"mini"},on:{click:t.refresh}},[t._v("刷新")])],1),t._v(" "),a("el-button-group",[a("el-button",{attrs:{type:"primary",size:"mini"}},[t._v("任务详情")]),t._v(" "),a("el-button",{attrs:{type:"info",size:"mini"},on:{click:t.attackShow}},[t._v("任务汇总")])],1)],1)],1),t._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.tableLoading,expression:"tableLoading"}],staticStyle:{width:"100%","margin-top":"5px"},attrs:{data:t.initData.records,border:"","header-cell-style":{color:"#909399",textAlign:"center",background:"#f5f7fa"},"cell-style":{padding:"12px 0"}}},[a("el-table-column",{attrs:{prop:"inet",label:"终端IP",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(a){return t.innetactive(e.row)}}},[t._v(t._s(e.row.inet))]),t._v(" "),a("i",{staticClass:"el-icon-circle-plus-outline",staticStyle:{"margin-left":"5px",color:"#3d95ff",cursor:"pointer"},on:{click:function(a){t.searchAdd({key:"inet",desc:"节点 IPv4"},e.row.inet)}}})]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"name",label:"名称"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(a){return t.handleEdit(e.row)}}},[e.row.report_hash!==e.row.hash?a("span",{staticStyle:{color:"red"}},[t._v("\n               "+t._s(e.row.name)),a("i",{staticClass:"el-icon-circle-plus-outline",staticStyle:{"margin-left":"5px",color:"#3d95ff",cursor:"pointer"},on:{click:function(a){return t.searchAdd({key:"name",desc:"配置名称"},e.row.name)}}}),t._v(" "),a("el-tooltip",{attrs:{effect:"dark",content:"下发的配置与数据库中的配置校验不一致",placement:"right"}},[a("i",{staticClass:"fa fa-exclamation-circle"})])],1):a("span",[t._v("\n              "+t._s(e.row.name)),a("i",{staticClass:"el-icon-circle-plus-outline",staticStyle:{"margin-left":"5px",color:"#3d95ff",cursor:"pointer"},on:{click:function(a){return t.searchAdd({key:"name",desc:"配置名称"},e.row.name)}}})])])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"from",label:"来源"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.from?a("span",[t._v(t._s(e.row.from))]):a("span",[t._v("未知")])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"dialect",label:"属性"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n        "+t._s(!0===e.row.dialect?"私有":"公有")+"\n      ")]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"status",label:"状态"},scopedSlots:t._u([{key:"default",fn:function(e){return["console"===e.row.from?a("span",[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"scope.row.error",placement:"bottom"}},[e.row.status?a("span",[a("el-tag",{attrs:{effect:"plain",size:"small",type:"running"===e.row.status?"success":"error"===e.row.status?"warning":"danger"}},[t._v(t._s(e.row.status)+"\n              "),a("span",{staticClass:"statu",class:"running"===e.row.status?"green-circle":"error"===e.row.status?"red-circle":"yellow-circle"})]),t._v(" "),a("i",{staticClass:"el-icon-circle-plus-outline",staticStyle:{"margin-left":"5px",color:"#3d95ff",cursor:"pointer"},on:{click:function(a){return t.searchAdd({key:"status",desc:"运行状态"},e.row.status)}}})],1):a("span",[t._v("未知\n              ")])])],1):a("span",[e.row.status?a("span",[a("el-tag",{attrs:{effect:"plain",size:"small",type:"running"===e.row.status?"success":"error"===e.row.status?"warning":"danger"}},[t._v(t._s(e.row.status)+"\n            "),a("span",{staticClass:"statu",class:"running"===e.row.status?"green-circle":"error"===e.row.status?"red-circle":"yellow-circle"})]),t._v(" "),a("i",{staticClass:"el-icon-circle-plus-outline",staticStyle:{"margin-left":"5px",color:"#3d95ff",cursor:"pointer"},on:{click:function(a){return t.searchAdd({key:"status",desc:"运行状态"},e.row.status)}}})],1):a("span",[t._v("未知\n            ")])])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"link",label:"外链"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.link?a("span",[t._v(t._s(e.row.link))]):a("span",[t._v("无")])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"created_at",label:"创建时间"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n        "+t._s(t._f("date")(e.row.created_at,"yyyy-MM-dd hh:mm:ss"))+"\n      ")]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"操作",align:"right",width:"180"},scopedSlots:t._u([{key:"default",fn:function(e){return["console"!==e.row.from?a("span",[a("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(a){return t.handleEvent(e.row)}}},[t._v("事件")]),t._v(" "),a("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(a){return t.reloadService(e.row)}}},[t._v("重启")])],1):t._e(),t._v(" "),e.row.dialect&&"startup"!==e.row.name?a("el-popover",{ref:e.row.substance_id,attrs:{placement:"top"}},[a("p",[t._v("确定删除?")]),t._v(" "),a("div",{staticStyle:{"text-align":"right",margin:"0"}},[a("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(a){t.$refs[e.row.substance_id].doClose()}}},[t._v("取消")]),t._v(" "),a("el-button",{attrs:{loading:t.delLoading,type:"primary",size:"mini"},on:{click:function(a){return t.delCode(e.row.substance_id)}}},[t._v("确定\n            ")])],1),t._v(" "),a("el-button",{staticStyle:{"margin-left":"3%"},attrs:{slot:"reference",type:"text",size:"mini"},slot:"reference"},[t._v("删除")])],1):a("span",{staticStyle:{color:"#c0c4cc","margin-left":"3%"}},[t._v("删除")])]}}])})],1),t._v(" "),a("Page",{attrs:{size:t.pageSize,current:t.currentPage,pageTotal:t.initData.total,pageSizeArray:t.pageSizeArray},on:{handleSizeChange:t.handleSizeChange,handleCurrentChange:t.handleCurrentChange}}),t._v(" "),a("el-drawer",{staticClass:"eventDrawer",attrs:{visible:t.processShow,direction:"rtl",size:"25%"},on:{"update:visible":function(e){t.processShow=e},close:t.processCancel}},[a("div",{staticStyle:{padding:"0  20px"}},[a("span",{staticStyle:{"font-size":"13px",color:"#86909c","font-weight":"bold"}},[a("el-row",{staticStyle:{"margin-bottom":"14px"}},[a("el-col",{attrs:{span:12}},[a("span",{staticClass:"controlCard",staticStyle:{"font-size":"12px"}},[t._v("进程详情")])])],1),t._v(" "),a("el-row",{staticStyle:{"margin-bottom":"14px"}},[a("el-col",{attrs:{span:24}},[t._v("进程名称\n              "),a("span",{staticClass:"subtitle"},[t._v(t._s(t.processDetailData.name))])])],1),t._v(" "),a("el-row",{staticStyle:{"margin-bottom":"14px"}},[a("el-col",{attrs:{span:24}},[t._v("内存使用"),a("span",{staticClass:"subtitle"},[t._v(t._s(t.processDetailData.mem_size||"-"))])])],1),t._v(" "),a("el-row",{staticStyle:{"margin-bottom":"14px"}},[a("el-col",{attrs:{span:24}},[t._v("进程PID"),a("span",{staticClass:"subtitle"},[t._v(t._s(t.processDetailData.pid))])])],1),t._v(" "),a("el-row",{staticStyle:{"margin-bottom":"14px"}},[a("el-col",{attrs:{span:24}},[t._v("进程PPID"),a("span",{staticClass:"subtitle"},[t._v(t._s(t.processDetailData.ppid))])])],1),t._v(" "),a("el-row",{staticStyle:{"margin-bottom":"14px"}},[a("el-col",{attrs:{span:24}},[t._v("用户信息"),a("span",{staticClass:"subtitle"},[t._v(t._s(t.processDetailData.username))])])],1),t._v(" "),a("el-row",{staticStyle:{"margin-bottom":"14px"}},[a("el-col",{attrs:{span:24}},[t._v("处理字节"),a("span",{staticClass:"subtitle"},[t._v(t._s(t.processDetailData.rss_bytes||"-"))])])],1),t._v(" "),a("el-row",{staticStyle:{"margin-bottom":"14px"}},[a("el-col",{attrs:{span:24}},[t._v("启动时间"),a("span",{staticClass:"subtitle"},[t._v(t._s(t._f("date")(t.processDetailData.created_at,"yyyy-MM-dd hh:mm:ss")))])])],1),t._v(" "),a("el-row",{staticStyle:{"margin-bottom":"14px"}},[a("el-col",{attrs:{span:24}},[t._v("启动参数"),a("span",{staticClass:"subtitle"},[t.processDetailData.args?a("span",[t.processDetailData.args.length>0?a("span",t._l(t.processDetailData.args,(function(e,i){return a("span",{key:i},[a("el-tag",{staticStyle:{"margin-right":"10px"},attrs:{type:"info",size:"mini"}},[t._v(t._s(e))])],1)})),0):t._e()]):a("span",[t._v("-")])])])],1),t._v(" "),a("el-row",{staticStyle:{"margin-bottom":"14px"}},[a("el-col",{attrs:{span:24}},[t._v("启动命令"),a("span",{staticClass:"subtitle"},[t._v(t._s(t.processDetailData.cmdline||"-"))])])],1),t._v(" "),a("el-row",{staticStyle:{"margin-bottom":"14px"}},[a("el-col",{attrs:{span:24}},[t._v("进程路径"),a("span",{staticClass:"subtitle"},[t._v(t._s(t.processDetailData.executable||"-"))])])],1),t._v(" "),a("el-row",{staticStyle:{"margin-bottom":"14px"}},[a("el-col",{attrs:{span:24}},[t._v("checksum"),a("span",{staticClass:"subtitle"},[t._v(t._s(t.processDetailData.checksum||"-"))])])],1)],1)])]),t._v(" "),a("AddForm",{ref:"formAdd",on:{handleEdit:t.handleEdit}}),t._v(" "),a("addService",{ref:"addService",on:{getNode:t.getNode}}),t._v(" "),t.eventDetailShow?a("Event",{ref:"eventDetail",attrs:{drawerEvent:t.drawerEvent,eventsData:t.eventsData},on:{closeEvent:t.closeEvent}}):t._e(),t._v(" "),a("el-drawer",{staticClass:"inetDrawer",attrs:{title:t.ipTtitel.inet,visible:t.drawer,direction:t.directions,"before-close":t.drawerClose,size:"90%"},on:{"update:visible":function(e){t.drawer=e}}},[a("node-detail",{ref:"ipDetail",attrs:{minionId:t.ipTtitel.minion_id,dataTask:t.ipTtitel}})],1)],1)}),[],!1,null,"024daed6",null).exports,f=a("g2+6"),h={components:{taskDetail:u,taskSum:a("CCOd").a,taskCount:f.a},name:"index",data:function(){return{taskDetailShow:!0,taskSumShow:!1,recentData:[],chartShow:!1}},methods:{activeClick:function(t,e){this.chartShow=!1,this.taskSumShow=t,this.taskDetailShow=e},activechartShow:function(){this.chartShow=!this.chartShow},getRecent:function(t){var e=this;this.$request.fetchRevent(t).then((function(t){e.recentData=t.data,e.recentShow=!0}))}}},p=Object(d.a)(h,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-card",[t.chartShow?a("el-row",{attrs:{gutter:10}},[a("el-col",{staticStyle:{"margin-bottom":"10px"},attrs:{span:24}},[a("taskCount")],1)],1):t._e(),t._v(" "),t.taskDetailShow?a("taskDetail",{on:{activeClick:t.activeClick,activechartShow:t.activechartShow}}):t._e(),t._v(" "),t.taskSumShow?a("taskSum",{on:{activeClick:t.activeClick,activechartShow:t.activechartShow}}):t._e()],1)}),[],!1,null,"f6c012e4",null);e.default=p.exports},EdA4:function(t,e,a){"use strict";a("GZYJ")},GZYJ:function(t,e,a){},JcAe:function(t,e,a){},PTvJ:function(t,e,a){},Zqxk:function(t,e,a){"use strict";a("PTvJ")},rGRj:function(t,e,a){},susv:function(t,e,a){},uYy4:function(t,e,a){"use strict";a.r(e);var i=a("gDS+"),s=a.n(i),n=a("25l2"),o=a("8rOb"),r=a("Wu6X"),c=a("bU/s"),l=a.n(c),d=(a("5Et9"),a("h9gT"),a("gD3r"),a("A8C4"),a("I/bj")),u=a.n(d),f=a("3oRf"),h=a.n(f),p=a("fWb1"),m=a.n(p);l.a.config.setModuleUrl("ace/mode/lua_worker",u.a),l.a.config.setModuleUrl("ace/mode/lua_worker",u.a),l.a.config.setModuleUrl("ace/mode/css_worker",h.a),l.a.config.setModuleUrl("ace/keyboard/vim",m.a);var v={name:"formCode",components:{IconSelect:r.a,Event:n.a,IndexForm:o.default},props:{isAdd:Boolean},data:function(){return{activeName:"first",evnetShow:!0,taskShow:!1,codeIcon:"",codeName:"",linkArray:[],form:{id:"",icon:"",chunk:"",version:0,name:""},serverData:[],dialogVisible:!1,linkData:[],dialogValue:"",dataTask:{},codeShow:!0}},updated:function(){this.editor=l.a.edit(this.$refs.generateId,{keyboardHandler:"ace/keyboard/vim",enableSnippets:!0,enableLiveAutocompletion:!0,enableBasicAutocompletion:!0,mode:"ace/mode/lua",theme:"ace/theme/dracula",fontSize:12,tabSize:2,value:this.dialogValue,selectionStyle:"text",showLineNumbers:!0,showGutter:!0,showPrintMargin:!0,printMarginColumn:170})},methods:{handleClick:function(t,e){"1"===t.index?this.taskShow=!0:this.taskShow=!1},dateTime:function(t){return a("wd/R")(t).format("YYYY-MM-DD HH:mm:ss")},refreshCode:function(){this.$emit("handleEdit",this.dataTask)},editCode:function(){this.codeShow=!this.codeShow},deleteLink:function(t){s()(this.linkArray);var e=this.linkArray.indexOf(t);this.linkArray.splice(e,1)},pushLink:function(t){this.linkArray.push(t)},selected:function(t){this.form.icon=t,this.codeIcon=t},nullChange:function(t){return""!==t&&" "!==t?t:"无"},filseSuccess:function(t,e){var a=this;if(t.raw){var i=new FileReader;i.onload=function(t){a.editor.setValue(t.target.result)},i.readAsText(t.raw)}},handleRemove:function(t,e){this.editor.setValue("")},handlePreview:function(t){},handleExceed:function(t,e){this.$message.warning("当前限制选择 3 个文件，本次选择了 "+t.length+" 个文件，共选择了 "+(t.length+e.length)+" 个文件")},beforeRemove:function(t,e){return this.$confirm("确定移除 $ { file.name } ？")},handleClose:function(){this.dialogVisible=!1,this.form={}},onSubmit:function(){var t=this,e=a("J66h").Base64,i=e.encode(this.editor.getValue(this.dialogValue)),s=e.encode(this.form.icon),n={id:this.form.id,icon:s,chunk:i,version:this.form.version,name:this.form.name};this.$request.fetchPatchCodeJob(n).then((function(e){t.refreshCode(),t.$message({message:"编辑成功",type:"success"})})).catch((function(e){t.$message.error(e.data)}))}},watch:{dialogValue:function(t){void 0!==this.editor&&(this.dialogValue=this.editor.setValue(t))}}},g=(a("Zqxk"),a("won1"),a("KHd+")),_=Object(g.a)(v,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-drawer",{staticClass:"systemSet",attrs:{visible:t.dialogVisible,"show-close":!1,direction:"rtl","before-close":t.handleClose,size:"90%"},on:{"update:visible":function(e){t.dialogVisible=e}}},[a("div",{attrs:{slot:"title"},slot:"title"}),t._v(" "),a("el-form",{ref:"form",staticStyle:{padding:"5px 10px 0"},attrs:{model:t.form,"label-width":"70px","label-position":"top"}},[a("el-row",[a("el-col",{attrs:{span:12}},[a("el-button",{attrs:{type:"text"}},[t._v(t._s(t.serverData.name))])],1),t._v(" "),a("el-col",{staticStyle:{"text-align":"right"},attrs:{span:12}},[a("i",{staticClass:"fa fa-code",staticStyle:{color:"#3d95ff"},attrs:{title:"显示/隐藏代码"},on:{click:t.editCode}}),t._v(" "),a("i",{staticClass:"fa fa-refresh",staticStyle:{"margin-left":"10px",color:"#63a35c",cursor:"pointer"},attrs:{title:"刷新"},on:{click:t.refreshCode}}),t._v(" "),a("i",{staticClass:"fa fa-cloud-upload",staticStyle:{"margin-left":"10px",color:"#3d95ff",cursor:"pointer"},attrs:{title:"提交"},on:{click:function(e){return t.onSubmit("form")}}}),t._v(" "),a("i",{staticClass:"fa fa-close",staticStyle:{margin:"0 5px 0 10px",color:"#9e9e9e",cursor:"pointer"},attrs:{title:"关闭"},on:{click:function(e){t.dialogVisible=!1}}})])],1),t._v(" "),a("el-row",[a("el-col",{attrs:{span:24}},[a("el-row",[t.codeShow?a("el-col",{attrs:{span:24}},[a("div",{ref:"generateId",staticClass:"code-editor"})]):t._e()],1)],1)],1)],1)],1)}),[],!1,null,"b8879466",null).exports,w=a("/zyf");l.a.config.setModuleUrl("ace/mode/lua_worker",u.a),l.a.config.setModuleUrl("ace/mode/lua_worker",u.a),l.a.config.setModuleUrl("ace/mode/css_worker",h.a),l.a.config.setModuleUrl("ace/keyboard/vim",m.a);var y={name:"addForm",components:{IconSelect:r.a},props:{isAdd:Boolean},data:function(){return{codeIcon:"",codeName:"",linkArray:[],form:{name:"",icon:"通用",desc:"",chunk:""},dialogVisible:!1,linkData:[],dialogValue:"",rules:{},editor:""}},updated:function(){var t=this;t.editor=l.a.edit(this.$refs.generateId,{keyboardHandler:"ace/keyboard/vim",enableSnippets:!0,enableLiveAutocompletion:!0,enableBasicAutocompletion:!0,mode:"ace/mode/lua",theme:"ace/theme/dracula",fontSize:12,tabSize:4,value:this.dialogValue,selectionStyle:"text'",showLineNumbers:!0,showGutter:!0,showPrintMargin:!0,printMarginColumn:170}),t.editor.getSession().on("change",(function(e){t.form.chunk=t.editor.getValue(this.dialogValue)}))},created:function(){this.getLinks()},methods:{linkCompare:function(t){return this.linkArray.some((function(e){if(e.id===t.id)return!0}))},deleteLink:function(t){s()(this.linkArray);var e=this.linkArray.indexOf(t);this.linkArray.splice(e,1)},pushLink:function(t){this.linkArray.push(t)},selected:function(t){this.form.icon=t,this.codeIcon=t},getLinks:function(){var t=this;this.$request.fetchGetLinks("").then((function(e){t.linkData=e.data})).catch((function(e){t.$message.error(e.data)}))},beforeRemove:function(t,e){return this.$confirm("确定移除 $ { file.name } ？")},filseSuccess:function(t,e){var a=this;if(t.raw){var i=new FileReader;i.onload=function(t){a.form.chunk=t.target.result},i.readAsText(t.raw)}},handleRemove:function(t,e){this.form.chunk=""},handleExceed:function(t,e){this.$message.warning("当前限制选择 3 个文件，本次选择了 "+t.length+" 个文件，共选择了 "+(t.length+e.length)+" 个文件")},handleClose:function(){this.dialogVisible=!1,this.form={}},onSubmit:function(t){var e=this;this.$refs[t].validate((function(t){if(t){var i=a("J66h").Base64,s=i.encode(e.form.chunk),n=i.encode(e.form.icon),o={name:e.form.name,icon:n,desc:e.form.desc,chunk:s};e.$request.fetchAddJobCode(o).then((function(t){e.$parent.getCode(),e.dialogVisible=!1,e.editor.setValue(""),e.form={name:"",icon:"kafka",desc:"",chunk:""},e.$refs.file.clearFiles(),e.$message({message:"新增成功",type:"success"})})).catch((function(t){e.$message.error(t.data)}))}}))}}},k=(a("5Ekh"),a("EdA4"),Object(g.a)(y,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{staticClass:"code-form",attrs:{"show-close":!1,"close-on-press-escape":!1,"close-on-click-modal":!1,top:"50px","el-dialog":"",visible:t.dialogVisible,"append-to-body":"",width:"70%"},on:{"update:visible":function(e){t.dialogVisible=e}}},[a("el-form",{ref:"form",staticClass:"formAdd",attrs:{model:t.form,rules:t.rules,"label-width":"40px"}},[a("el-row",[a("el-col",{staticStyle:{margin:"20px 20px"},attrs:{span:5}},[a("el-form-item",{attrs:{label:" ",prop:"chunk"}},[a("el-upload",{ref:"file",staticClass:"upload-demo",attrs:{action:"/","on-remove":t.handleRemove,"before-remove":t.beforeRemove,"on-change":t.filseSuccess,multiple:"",limit:3,"on-exceed":t.handleExceed,"auto-upload":!1}},[a("el-button",{attrs:{size:"mini",type:"primary"}},[t._v("点击上传 chunk")])],1)],1),t._v(" "),a("el-form-item",{attrs:{label:"名称",prop:"name"}},[a("el-input",{attrs:{type:"text",size:"mini"},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"图标",prop:"icon"}},[a("el-popover",{attrs:{placement:"bottom-start",width:"460",trigger:"click"},on:{show:function(e){return t.$refs.iconSelect.reset()}}},[a("IconSelect",{ref:"iconSelect",on:{selected:t.selected}}),t._v(" "),a("el-input",{attrs:{slot:"reference",placeholder:"点击选择图标",size:"mini",readonly:""},slot:"reference",model:{value:t.form.icon,callback:function(e){t.$set(t.form,"icon",e)},expression:"form.icon"}},[t._v("\n              "+t._s(t.form.icon)+"\n              "),t.form.icon?a("svg-icon",{staticClass:"el-input__icon",staticStyle:{height:"42px",width:"16px"},attrs:{slot:"prefix","icon-class":t.form.icon},slot:"prefix"}):a("i",{staticClass:"el-icon-search el-input__icon",attrs:{slot:"prefix"},slot:"prefix"})],1)],1)],1),t._v(" "),a("el-form-item",{attrs:{label:"描述",prop:"desc"}},[a("el-input",{attrs:{type:"textarea",placeholder:"请输入描述"},model:{value:t.form.desc,callback:function(e){t.$set(t.form,"desc",e)},expression:"form.desc"}})],1),t._v(" "),a("span",{staticStyle:{width:"100%","text-align":"right",display:"inline-block"}},[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.onSubmit("form")}}},[t._v("提交")])],1)],1),t._v(" "),a("div",{staticStyle:{height:"20px","text-align":"right",padding:"5px"}},[a("i",{staticClass:"fa fa-close",staticStyle:{margin:"0 5px 0 10px",color:"#9e9e9e",cursor:"pointer"},on:{click:function(e){t.dialogVisible=!1}}})]),t._v(" "),a("div",{ref:"generateId",staticClass:"code-editor"})],1)],1),t._v(" "),a("div",{attrs:{slot:"title"},slot:"title"})],1)}),[],!1,null,"c5620416",null).exports),b=(a("vQJo"),{name:"node",components:{Form:_,Page:w.a,AddForm:k},data:function(){return{current:1,size:10,pageTotal:0,pageSizeArray:["10","20","30","40"],codeData:[],isAdd:!0,delLoading:!1,avatar:"../../../static/images/favicon.ico",selectInput:""}},created:function(){this.getCode()},methods:{iconImg:function(t){return a("J66h").Base64.decode(t)},edit:function(t){var e=this;this.$request.fetchGetChunk(t.id).then((function(i){var s=a("J66h").Base64,n=e.$refs.forms;n.serverData=t,n.dialogValue=s.decode(i.data.chunk),n.form={name:i.data.name,icon:s.decode(i.data.icon),desc:i.data.desc,links:i.data.links,chunk:s.decode(i.data.chunk),id:i.data.id,version:i.data.version},n.codeIcon=s.decode(i.data.icon),n.codeName=i.data.name,n.linkArray=i.data.links,n.dialogVisible=!0})).catch((function(t){e.$message.error(t.data)}))},format:function(t){return 100===t?"100%":t+"%"},percentageChange:function(t,e){return 0===t?0:parseInt(t/e*1e4)/100},customColorMethod:function(t,e){var a=this.percentageChange(t,e);return a<30?"#67c23a":a<70?"#e6a23c":"#f56c6c"},handleSizeChange:function(t){this.size=t,this.getCode()},handleCurrentChange:function(t){this.current=t,this.getCode()},addCode:function(){var t=this;this.$nextTick((function(){t.$refs.formAdd.dialogVisible=!0}))},subDelete:function(t){var e=this,a=this;a.delLoading=!0;var i={id:t};this.$request.fetchDeleteJob(i).then((function(t){a.$message({message:"删除成功!!!",type:"success"}),a.delLoading=!1,a.getCode()})).catch((function(t){e.$message.error(t.data)}))},getCode:function(){var t=this,e={current:this.current,size:this.size,name:this.selectInput};this.$request.fetchGetJobCdes(e).then((function(e){t.codeData=e.data.records,t.pageTotal=e.data.total})).catch((function(e){t.$message.error(e.data)}))},handleEdit:function(t,e){},handleDelete:function(t,e){this.$message({showClose:!0,message:t,row:e,type:"success"})},formatter:function(t,e){return t.address},filterTag:function(t,e){return e.tag===t},filterHandler:function(t,e,a){return e[a.property]===t}}}),S=(a("xtak"),Object(g.a)(b,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticStyle:{width:"100%"}},[a("el-card",[a("el-row",[a("el-col",{attrs:{span:12}},[a("el-input",{staticClass:"input-with-select",staticStyle:{width:"20%"},attrs:{placeholder:"请输入名称",size:"mini"},model:{value:t.selectInput,callback:function(e){t.selectInput=e},expression:"selectInput"}}),t._v(" "),a("el-button",{staticStyle:{color:"#909399",background:"#f4f4f5","border-color":"#d3d4d6"},attrs:{icon:"el-icon-search",size:"mini"},on:{click:t.getCode}})],1),t._v(" "),a("el-col",{staticStyle:{"text-align":"right"},attrs:{span:12}},[a("el-button",{staticStyle:{"margin-left":"0"},attrs:{"el-button":"",type:"success",plain:"",size:"mini"},on:{click:t.addCode}},[t._v("添加")])],1)],1),t._v(" "),null!==t.codeData?a("div",{staticClass:"ivu-list-split"},t._l(t.codeData,(function(e){return a("ul",{key:e.id,staticClass:"ivu-list-items"},[a("li",{staticClass:"ivu-list-item"},[a("div",{staticClass:"ivu-list-item-meta"},[a("div",{staticClass:"ivu-list-item-meta-avatar"},[a("span",{staticClass:"ivu-avatar ivu-avatar-square ivu-avatar-image ivu-avatar-large"},[a("svg-icon",{staticClass:"el-input__icon",staticStyle:{height:"42px",width:"32px"},attrs:{slot:"prefix","icon-class":t.iconImg(e.icon)},slot:"prefix"})],1)]),t._v(" "),a("div",{staticClass:"ivu-list-item-meta-content"},[a("div",{staticClass:"ivu-list-item-meta-title"},[t._v(t._s(e.desc))]),t._v(" "),a("div",{staticClass:"ivu-list-item-meta-description"},[t._v(t._s(e.name))])])]),t._v(" "),a("div",{staticClass:"list-basic-list-content"},[a("div",{staticClass:"list-basic-list-content-item",staticStyle:{width:"240px"}},[a("span",[t._v("开始时间")]),t._v(" "),a("p",[t._v(t._s(t._f("date")(e.created_at,"yyyy-MM-dd hh:mm:ss")))])])]),t._v(" "),a("ul",{staticClass:"ivu-list-item-action"},[a("li",[a("el-button",{attrs:{type:"text"},on:{click:function(a){return t.edit(e)}}},[t._v("编辑")])],1),t._v(" "),a("li",[a("el-button",{attrs:{type:"text"},on:{click:function(a){return t.subDelete(e.id)}}},[t._v("删除")])],1)])])])})),0):a("div",[a("el-empty",{attrs:{description:"暂无数据"}})],1),t._v(" "),a("Page",{attrs:{size:t.size,current:t.current,pageSizeArray:t.pageSizeArray,pageTotal:t.pageTotal},on:{handleSizeChange:t.handleSizeChange,handleCurrentChange:t.handleCurrentChange}})],1),t._v(" "),a("Form",{ref:"forms",attrs:{"is-add":t.isAdd}}),t._v(" "),a("AddForm",{ref:"formAdd"})],1)}),[],!1,null,"6642530f",null));e.default=S.exports},won1:function(t,e,a){"use strict";a("susv")},xtak:function(t,e,a){"use strict";a("rGRj")}}]);
//# sourceMappingURL=10.dea4e8ddbf1ec19c5990.js.map