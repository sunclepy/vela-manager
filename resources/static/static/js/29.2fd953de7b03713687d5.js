(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{"/zyf":function(e,t,a){"use strict";var i={name:"page",props:{pageSizeArray:Array,size:Number,pageTotal:Number,current:Number,nameShow:String},data:function(){return{pageCurrent:this.current}},methods:{handleSizeChange:function(e){this.$emit("handleSizeChange",e)},handleCurrentChange:function(e){this.$emit("handleCurrentChange",e)}},watch:{current:function(e){this.pageCurrent=e}}},n=(a("t2r+"),a("KHd+")),r=Object(n.a)(i,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{class:"事件详情"===e.nameShow?"pageClass":"",staticStyle:{height:"20px","padding-top":"10px"}},[a("span",{staticStyle:{display:"inline-block","font-size":"13px","min-width":"35.5px",height:"28px","line-height":"30px","vertical-align":"top","box-sizing":"border-box",float:"right"}},[e._v("共"+e._s(e.pageTotal)+"条")]),e._v(" "),a("el-pagination",{staticStyle:{float:"right"},attrs:{background:"",layout:"prev, pager, next","page-size":e.size,"current-page":e.pageCurrent,total:e.pageTotal},on:{"update:currentPage":function(t){e.pageCurrent=t},"update:current-page":function(t){e.pageCurrent=t},"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)}),[],!1,null,"40b774d6",null);t.a=r.exports},"3wfX":function(e,t,a){},"9kPx":function(e,t,a){"use strict";a.r(t);var i={name:"formService",props:{isAdd:Boolean,codeList:Array},data:function(){return{form:{id:"",name:"",desc:"",code_ids:[],semver:""},dialogVisible:!1,rules:{name:[{required:!0,message:"请输入名称",trigger:"blur"}],desc:[{required:!0,message:"请输入描述",trigger:"blur"}],code_ids:[{required:!0,message:"请选择插件",trigger:"change"}]}}},methods:{handleClose:function(){this.dialogVisible=!1},onSubmit:function(e){var t=this;this.$refs[e].validate((function(e){e&&(t.isAdd?t.$request.fetchAddService(t.form).then((function(){t.$message({message:"添加成功!!!",type:"success"}),t.$parent.getService(),t.dialogVisible=!1,t.form={}})).catch((function(e){t.$message.error(e.data)})):t.$request.fetchUpdataService(t.form).then((function(){t.$message({message:"编辑成功!!!",type:"success"}),t.$parent.getService(),t.dialogVisible=!1,t.form={}})).catch((function(e){t.$message.error(e.data)})))}))}}},n=a("KHd+"),r=Object(n.a)(i,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{"before-close":e.handleClose,"el-dialog":"","close-on-click-modal":!1,visible:e.dialogVisible,title:e.isAdd?"新增服务":"编辑服务","append-to-body":"",width:"500px"},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,size:"small","label-width":"95px"}},[a("el-form-item",{attrs:{label:"名称",prop:"name"}},[a("el-input",{attrs:{type:"text"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"描述",prop:"desc"}},[a("el-input",{attrs:{type:"text"},model:{value:e.form.desc,callback:function(t){e.$set(e.form,"desc",t)},expression:"form.desc"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"插件",prop:"code_ids"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{multiple:""},model:{value:e.form.code_ids,callback:function(t){e.$set(e.form,"code_ids",t)},expression:"form.code_ids"}},e._l(e.codeList,(function(e){return a("el-option",{key:e.id,attrs:{value:e.id,label:e.name}})})),1)],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.onSubmit("form")}}},[e._v(e._s(e.isAdd?"创建":"修改"))])],1)],1)}),[],!1,null,"89f5a772",null).exports,o=(a("vQJo"),{name:"index",components:{Page:a("/zyf").a,EditForm:r},data:function(){return{archData:[{value:"386",label:"386"},{value:"amd64",label:"amd64"}],paltformList:["linux","windows","darwin"],downShow:!1,copyvalue:"",roomData:[],selectData:{},editionId:"",activeData:{},current:1,size:10,pageTotal:0,agentData:[],isAdd:!0,delLoading:!1,agentList:[],selectInput:"",fileShow:!1,form:{name:"",goos:"",file:"",arch:"",semver:"",changelog:""},rules:{file:[{required:!0,message:"请上传文件",trigger:"change"}],semver:[{required:!0,message:"请输入版本",trigger:"blur"}],name:[{required:!0,message:"请输入文件名",trigger:"blur"}],arch:[{required:!0,message:"请输入系统架构",trigger:"change"}],goos:[{required:!0,message:"请输入操作系统",trigger:"blur"}]},value:"",pageSizeArray:[10,20,30,40],upShow:!1}},created:function(){this.getAgent()},methods:{firstCopySuccess:function(){this.$message.success("内容已复制到剪切板！")},onSubmit:function(){var e=this,t=new FormData;t.append("name",this.form.name),t.append("file",this.form.file),t.append("semver",this.form.semver),t.append("goos",this.form.goos),t.append("arch",this.form.arch),this.$request.fetchUploadFile(t).then((function(t){e.$message({message:"添加成功!!!",type:"success"}),e.fileShow=!1,e.form={},e.$refs.file.clearFiles(),e.getAgent()})).catch((function(t){e.$message.error(t.data)}))},uploadClick:function(e){"新增"!==e?(this.form=e,this.upShow=!1):this.upShow=!0,this.fileShow=!0},handleClose:function(){this.form={},this.fileShow=!1},operaEdition:function(e){var t=this;this.$refs[e.id+1].doClose();var a=this;this.$request.fetchCheckEdtion({id:e.id}).then((function(e){a.$message({message:"推送成功!!!",type:"success"}),a.getAgent()})).catch((function(e){t.$message.error(e.data)}))},fileDownload:function(e){var t=this;this.activeData=e,this.editionId=e.id,this.downShow=!0,this.$request.fetchGetIndices().then((function(e){t.roomData=e.data}))},downFile:function(){if(this.selectData.id){var e=document.createElement("a");e.href="/api/deploy/minion/download?id="+this.editionId+"&broker_id="+this.selectData.id,e.target="_blank",e.click()}else this.$message.error("请选择")},seletRoom:function(){var e=this;this.$request.fetchGetLan().then((function(t){e.value=t.data.scheme+"://"+t.data.addr+"/api/deploy/minion?goos="+e.activeData.goos+"&broker_id="+e.selectData.id+"&arch="+e.activeData.arch}))},lanShare:function(){this.selectData.id?this.selectData.lan.length>0?this.copyvalue=this.value:(this.copyvalue="",this.$message.error("暂无内网")):(this.copyvalue="",this.$message.error("请选择"))},vipShare:function(){this.selectData.id?this.copyvalue=window.location.protocol+"//"+window.location.host+"/api/deploy/minion?goos="+this.activeData.goos+"&broker_id="+this.selectData.id+"&arch="+this.activeData.arch:this.$message.error("请选择")},wsJudge:function(e){return"ws"===e?"http":"https"},filseSuccess:function(e,t){this.form.file=e.raw},handleRemove:function(e,t){this.form.file=""},beforeRemove:function(e,t){return this.$confirm("确定移除 $ { file.name } ？")},handleExceed:function(e,t){this.$message.warning("当前限制选择 3 个文件，本次选择了 "+e.length+" 个文件，共选择了 "+(e.length+t.length)+" 个文件")},subDelete:function(e){var t=this;this.$refs[e].doClose();var a=this;a.delLoading=!0,this.$request.fetchDeleteAgent(e).then((function(e){a.$message({message:"删除成功!!!",type:"success"}),a.delLoading=!1,a.getAgent()})).catch((function(e){t.$message.error(e.data)}))},deprecate:function(e){var t=this;this.$refs[e.id+2].doClose();var a=this;this.$request.fetchDeprecate({id:e.id}).then((function(e){a.$message({message:"标记成功!!!",type:"success"}),a.getAgent()})).catch((function(e){t.$message.error(e.data)}))},getAgent:function(){var e=this,t={current:this.current,size:this.size};this.$request.fetchGetAgent(t).then((function(t){e.agentData=t.data.records,e.pageTotal=t.data.total})).catch((function(t){e.$message.error(t.data)}))},percentageChange:function(e,t){return 0===e?0:parseInt(e/t*1e4)/100},customColorMethod:function(e,t){var a=this.percentageChange(e,t);return a<30?"#67c23a":a<70?"#e6a23c":"#f56c6c"},handleSizeChange:function(e){this.size=e,this.getAgent()},handleCurrentChange:function(e){this.current=e,this.getAgent()},handleDelete:function(e,t){this.$message({showClose:!0,message:e,row:t,type:"success"})},formatter:function(e,t){return e.address},filterTag:function(e,t){return t.tag===e},filterHandler:function(e,t,a){return t[a.property]===e},selectSearch:function(){var e=this;""!==this.selectInput?this.agentData=this.agentData.filter((function(t){return!e.selectInput||t.name.toLowerCase().includes(e.selectInput.toLowerCase())})):this.getAgent()}}}),s=(a("V9bG"),Object(n.a)(o,(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticStyle:{width:"100%"}},[a("el-card",[a("el-row",[a("el-col",{attrs:{span:12}},[a("el-input",{staticClass:"input-with-select",staticStyle:{width:"20%"},attrs:{placeholder:"请输入名称",size:"mini"},model:{value:e.selectInput,callback:function(t){e.selectInput=t},expression:"selectInput"}}),e._v(" "),a("el-button",{staticStyle:{color:"#909399",background:"#f4f4f5","border-color":"#d3d4d6"},attrs:{icon:"el-icon-search",size:"mini"},on:{click:e.selectSearch}})],1),e._v(" "),a("el-col",{staticStyle:{"text-align":"right"},attrs:{span:12}},[a("el-button",{staticStyle:{"margin-left":"0"},attrs:{"el-button":"",type:"success",plain:"",size:"mini"},on:{click:function(t){return e.uploadClick("新增")}}},[e._v("添加\n        ")])],1)],1),e._v(" "),a("el-table",{staticClass:"tableCell",staticStyle:{width:"100%","margin-top":"5px"},attrs:{data:e.agentData,"cell-style":{padding:"0px"},border:"","header-cell-style":{color:"#909399",textAlign:"center",background:"#f5f7fa"}}},[a("el-table-column",{attrs:{prop:"name",label:"名称"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-badge",{staticClass:"item",attrs:{value:!0===t.row.deprecated?"已过期":"",type:"warning"}},[a("el-button",{attrs:{size:"small",type:"text"}},[e._v(" "+e._s(t.row.name))])],1)]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"goos",label:"平台"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row?a("span"):e._e(),e._v(" "),a("svg",{staticClass:"iconTabel",attrs:{"aria-hidden":"true"}},[a("use",{attrs:{"xlink:href":"linux"===t.row.goos?"#icon-linux1":"windows"===t.row.goos?"#icon-Windows1":"#icon-pingguo"}})]),e._v("\n          "+e._s(t.row.goos)+"\n        ")]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"arch",label:"arch"}}),e._v(" "),a("el-table-column",{attrs:{prop:"semver",label:"版本"}}),e._v(" "),a("el-table-column",{attrs:{prop:"created_at",label:"创建时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s(e._f("date")(t.row.created_at,"yyyy-MM-dd hh:mm:ss"))+"\n        ")]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"updated_at",label:"更新时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s(e._f("date")(t.row.updated_at,"yyyy-MM-dd hh:mm:ss"))+"\n        ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"操作",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-popover",{ref:t.row.id+1,attrs:{placement:"top",width:"200"}},[a("p",[e._v("确定推送?")]),e._v(" "),a("div",{staticStyle:{"text-align":"right",margin:"0"}},[a("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(a){e.$refs[t.row.id+1].doClose()}}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{loading:e.delLoading,type:"primary",size:"mini"},on:{click:function(a){return e.operaEdition(t.row)}}},[e._v("确定\n              ")])],1),e._v(" "),a("el-button",{attrs:{slot:"reference",type:"text",size:"mini",disabled:!0===t.row.deprecated},slot:"reference"},[e._v("推送")])],1),e._v(" "),a("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"text",size:"mini"},on:{click:function(a){return e.fileDownload(t.row)}}},[e._v("下载")]),e._v(" "),a("el-popover",{ref:t.row.id,attrs:{placement:"top",width:"200"}},[a("p",[e._v("确定删除?")]),e._v(" "),a("div",{staticStyle:{"text-align":"right",margin:"0"}},[a("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(a){e.$refs[t.row.id].doClose()}}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{loading:e.delLoading,type:"primary",size:"mini"},on:{click:function(a){return e.subDelete(t.row.id)}}},[e._v("确定\n              ")])],1),e._v(" "),a("el-button",{staticStyle:{"margin-left":"10px"},attrs:{slot:"reference",type:"text",size:"mini"},slot:"reference"},[e._v("删除")])],1),e._v(" "),a("el-popover",{ref:t.row.id+2,attrs:{placement:"top",width:"200"}},[a("p",[e._v("将Agent版本标记为过期?")]),e._v(" "),a("div",{staticStyle:{"text-align":"right",margin:"0"}},[a("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(a){e.$refs[t.row.id+2].doClose()}}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{loading:e.delLoading,type:"primary",size:"mini"},on:{click:function(a){return e.deprecate(t.row)}}},[e._v("确定")])],1),e._v(" "),a("el-button",{staticStyle:{"margin-left":"10px"},attrs:{slot:"reference",type:"text",size:"mini",disabled:!0===t.row.deprecated},slot:"reference"},[e._v("标记过期\n            ")])],1)]}}])})],1),e._v(" "),a("Page",{attrs:{size:e.size,current:e.current,pageTotal:e.pageTotal,pageSizeArray:e.pageSizeArray},on:{handleSizeChange:e.handleSizeChange,handleCurrentChange:e.handleCurrentChange}})],1),e._v(" "),a("EditForm",{ref:"forms",attrs:{"is-add":e.isAdd,agentList:e.agentList}}),e._v(" "),a("el-dialog",{attrs:{"before-close":e.handleClose,"el-dialog":"","close-on-click-modal":!1,visible:e.fileShow,title:!0===e.upShow?"新增":"上传","append-to-body":"",width:"500px"},on:{"update:visible":function(t){e.fileShow=t}}},[a("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,size:"small","label-width":"100px"}},[a("el-form-item",{attrs:{label:"文件名",prop:"name"}},[a("el-input",{attrs:{type:"text",size:"mini"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"版本",prop:"semver"}},[a("el-input",{attrs:{type:"text",size:"mini"},model:{value:e.form.semver,callback:function(t){e.$set(e.form,"semver",t)},expression:"form.semver"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"文件",prop:"file"}},[a("el-upload",{ref:"file",staticClass:"upload-demo",attrs:{action:"/","on-remove":e.handleRemove,"before-remove":e.beforeRemove,"on-change":e.filseSuccess,multiple:"",limit:1,"on-exceed":e.handleExceed,"auto-upload":!1}},[a("el-button",{attrs:{size:"small",icon:"el-icon-upload"}},[e._v("点击上传")])],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"操作系统",prop:"goos"}},[a("el-select",{staticStyle:{width:"100%"},model:{value:e.form.goos,callback:function(t){e.$set(e.form,"goos",t)},expression:"form.goos"}},e._l(e.paltformList,(function(e,t){return a("el-option",{key:t,attrs:{value:e,label:e}})})),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"系统架构",prop:"arch"}},[a("el-select",{staticStyle:{width:"100%"},model:{value:e.form.arch,callback:function(t){e.$set(e.form,"arch",t)},expression:"form.arch"}},e._l(e.archData,(function(e){return a("el-option",{key:e.label,attrs:{value:e.value,label:e.label}})})),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"版本更新日志",prop:"changelog"}},[a("el-input",{attrs:{type:"textarea",rows:2,placeholder:"请输入内容"},model:{value:e.form.changelog,callback:function(t){e.$set(e.form,"changelog",t)},expression:"form.changelog"}})],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.fileShow=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.onSubmit("form")}}},[e._v("提交")])],1)],1),e._v(" "),a("el-dialog",{attrs:{visible:e.downShow,title:"下载客户端",width:"30%"},on:{"update:visible":function(t){e.downShow=t}}},[a("el-select",{attrs:{size:"mini","value-key":"id"},on:{change:e.seletRoom},model:{value:e.selectData,callback:function(t){e.selectData=t},expression:"selectData"}},e._l(e.roomData,(function(e){return a("el-option",{key:e.id,attrs:{value:e,label:e.name}})})),1),e._v(" "),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.downFile}},[e._v("下载")]),e._v(" "),a("el-button",{directives:[{name:"clipboard",rawName:"v-clipboard:copy",value:e.copyvalue,expression:"copyvalue",arg:"copy"},{name:"clipboard",rawName:"v-clipboard:success",value:e.firstCopySuccess,expression:"firstCopySuccess",arg:"success"}],attrs:{type:"primary",size:"mini"},on:{click:e.lanShare}},[e._v("内网分享\n    ")]),e._v(" "),a("el-button",{directives:[{name:"clipboard",rawName:"v-clipboard:copy",value:e.copyvalue,expression:"copyvalue",arg:"copy"},{name:"clipboard",rawName:"v-clipboard:success",value:e.firstCopySuccess,expression:"firstCopySuccess",arg:"success"}],attrs:{type:"primary",size:"mini"},on:{click:e.vipShare}},[e._v("外网分享\n    ")])],1)],1)}),[],!1,null,"843dad64",null));t.default=s.exports},TzQq:function(e,t,a){},V9bG:function(e,t,a){"use strict";a("3wfX")},"t2r+":function(e,t,a){"use strict";a("TzQq")},vQJo:function(e,t,a){"use strict";a("oCYn").default.filter("date",(function(e,t){var a=new Date(e),i={"M+":a.getMonth()+1,"d+":a.getDate(),"h+":a.getHours(),"m+":a.getMinutes(),"s+":a.getSeconds(),"q+":Math.floor((a.getMonth()+3)/3),S:a.getMilliseconds()};for(var n in/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(a.getFullYear()+"").substr(4-RegExp.$1.length))),i)new RegExp(`(${n})`).test(t)&&(t=t.replace(RegExp.$1,1===RegExp.$1.length?i[n]:("00"+i[n]).substr((""+i[n]).length)));return t}))}}]);
//# sourceMappingURL=29.2fd953de7b03713687d5.js.map